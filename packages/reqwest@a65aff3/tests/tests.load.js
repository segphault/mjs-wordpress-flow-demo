montageDefine("a65aff3","tests/tests",{dependencies:[],factory:function(require,exports,module){(function(ajax){function createSerializeHelper(e){function t(){m[1].reset()}function n(e,t,n){return m[e].getElementsByTagName(t)[n]}function i(e){return"[object Array]"==Object.prototype.toString.call(e)}function r(e,t){if(null==t)return null===e;if(i(t)){if(e.length!==t.length)return!1;for(var n=0;t.length>n;n++)if(e[n]!=t[n])return!1;return!0}return e==t}function a(t,n,a,s){var o,l,c=ajax.serialize(t,{type:"array"}),u=ajax.serialize(t,{type:"map"});if(null!=a){for(o=i(a)?a:[a],e(c.length==o.length,"serialize("+s+", {type:'array'}) returns array "+"[{name,value}]"),l=0;o.length>l;l++)e(n==c[l].name,"serialize("+s+", {type:'array'})["+l+"].name"),e(o[l]==c[l].value,"serialize("+s+", {type:'array'})["+l+"].value");e(r(u[n],a),"serialize("+s+", {type:'map'})")}else e(0===c.length,"serialize("+s+", {type:'array'}) is []"),e(0===v.keys(u).length,"serialize("+s+", {type:'map'}) is {}")}function s(t,n){var i="foo=bar&bar=baz&wha=1&wha=3&who=tawoo&%24escapable+name%24=escapeme&choices=two&opinions=world+peace+is+not+real";e(t,"serialize() bound to context"),e((t?t(m[0]):null)==i,"serialized form ("+n+")")}function o(e,t,n){var i=[f,g,_],r=t===y?ender(i):null,a=t===b?i:[];return n&&a.push(n),e.apply(r,a)}function l(t,n,i){e(t,"serialize() bound in context");var r=t?o(t,i):null;e("foo=bar&bar=baz&choices=two"==r,"serialized all 3 arguments together")}function c(t,n){var i,r=[{name:"foo",value:"bar"},{name:"bar",value:"baz"},{name:"wha",value:1},{name:"wha",value:3},{name:"who",value:"tawoo"},{name:"$escapable name$",value:"escapeme"},{name:"choices",value:"two"},{name:"opinions",value:"world peace is not real"}];for(i=0;r.length>i;i++)e(v.some(t,function(e){return e.name==r[i].name&&e.value==r[i].value}),"serialized "+r[i].name+" ("+n+")")}function u(t,n){e(t,"serialize(..., {type:'array'}) bound to context");var i=t?t(m[0],{type:"array"}):[];i||(i=[]),c(i,n)}function h(t,n,i){e(t,"serialize(..., {type:'array'}) bound to context");var r=t?o(t,i,{type:"array"}):[];r||(r=[]),e(3==r.length,"serialized as array of 3"),e(3==r.length&&"foo"==r[0].name&&"bar"==r[0].value,"serialized first element ("+n+")"),e(3==r.length&&"bar"==r[1].name&&"baz"==r[1].value,"serialized second element ("+n+")"),e(3==r.length&&"choices"==r[2].name&&"two"==r[2].value,"serialized third element ("+n+")")}function d(t,n){var i,a={foo:"bar",bar:"baz",wha:["1","3"],who:"tawoo","$escapable name$":"escapeme",choices:"two",opinions:"world peace is not real"};e(t,"serialize({type:'map'}) bound to context"),i=t?t(m[0],{type:"map"}):{},i||(i={}),e(v.keys(a).length===v.keys(i).length,"same number of keys ("+n+")"),v.each(v.keys(a),function(t){e(r(a[t],i[t]),"same value for "+t+" ("+n+")")})}function p(t,n,i){e(t,"serialize({type:'map'}) bound to context");var r=t?o(t,i,{type:"map"}):{};r||(r={}),e("bar"==r.foo,"serialized first element ("+n+")"),e("baz"==r.bar,"serialized second element ("+n+")"),e("two"==r.choices,"serialized third element ("+n+")")}var m=document.forms,f=m[0].getElementsByTagName("input")[1],g=m[0].getElementsByTagName("input")[2],_=m[0].getElementsByTagName("select")[0],y="bind",b="pass";return{reset:t,formElements:n,testInput:a,testFormSerialize:s,testMultiArgumentSerialize:l,testFormSerializeArray:u,verifyFormSerializeArray:c,testMultiArgumentSerializeArray:h,testFormSerializeHash:d,testMultiArgumentSerializeHash:p}}var BIND_ARGS="bind",PASS_ARGS="pass",FakeXHR=function(){function e(){this.args={},e.last=this}return e.setup=function(){e.oldxhr=window.XMLHttpRequest,e.oldaxo=window.ActiveXObject,window.XMLHttpRequest=e,window.ActiveXObject=e,e.last=null},e.restore=function(){window.XMLHttpRequest=e.oldxhr,window.ActiveXObject=e.oldaxo},e.prototype.methodCallCount=function(e){return this.args[e]?this.args[e].length:0},e.prototype.methodCallArgs=function(e,t,n){var i=this.args[e]&&this.args[e].length>t?this.args[e][t]:null;return arguments.length>2?i&&i.length>n?i[n]:null:i},v.each(["open","send","setRequestHeader"],function(t){e.prototype[t]=function(){this.args[t]||(this.args[t]=[]),this.args[t].push(arguments)}}),e}();sink("Setup",function(e,t,n,i){n(function(){ajax.ajaxSetup({dataFilter:function(e){return e.substring("])}while(1);</x>".length)}})}),i(function(){ajax.ajaxSetup({dataFilter:function(e){return e}})}),e("dataFilter",function(e){ajax({url:"/tests/fixtures/fixtures_with_prefix.json",type:"json",success:function(n){t(n,"received response"),t(n&&"boosh"==n.boosh,"correctly evaluated response as JSON"),e()}})})}),sink("Mime Types",function(e,t){e("JSON",function(e){ajax({url:"/tests/fixtures/fixtures.json",type:"json",success:function(n){t(n,"received response"),t(n&&"boosh"==n.boosh,"correctly evaluated response as JSON"),e()}})}),e("JSONP",function(e){reqwest.getcallbackPrefix=function(e){return"reqwest_"+e},ajax({url:"/tests/fixtures/fixtures_jsonp.jsonp?callback=?",type:"jsonp",success:function(n){t(n,"received response for unique generated callback"),t(n&&"boosh"==n.boosh,"correctly evaled response for unique generated cb as JSONP"),e()}})}),e("JS",function(e){ajax({url:"/tests/fixtures/fixtures.js",type:"js",success:function(){t("undefined"!=typeof boosh&&"boosh"==boosh,"evaluated response as JavaScript"),e()}})}),e("HTML",function(e){ajax({url:"/tests/fixtures/fixtures.html",type:"html",success:function(n){t("<p>boosh</p>"==n,"evaluated response as HTML"),e()}})}),e("XML",function(e){ajax({url:"/tests/fixtures/fixtures.xml",type:"xml",success:function(n){t(n&&n.documentElement&&"root"==n.documentElement.nodeName,"XML Response root is <root>"),t(n&&n.documentElement&&n.documentElement.hasChildNodes&&"boosh"==n.documentElement.firstChild.nodeName&&"boosh"==n.documentElement.firstChild.firstChild.nodeValue,"Correct XML response"),e()},error:function(n){t(!1,n.responseText),e()}})}),e("XML (404)",function(e){ajax({url:"/tests/fixtures/badfixtures.xml",type:"xml",success:function(n){null==n?(t(!0,"XML response is null"),e()):(t(n&&n.documentElement&&n.documentElement.firstChild&&/error/i.test(n.documentElement.firstChild.nodeValue),"XML response reports parsing error"),e())},error:function(){t(!0,"No XML response (error())"),e()}})})}),sink("JSONP",function(e,t){e("Named callback in query string",function(e){ajax({url:"/tests/fixtures/fixtures_jsonp2.jsonp?foo=bar",type:"jsonp",jsonpCallback:"foo",success:function(n){t(n,"received response for custom callback"),t(n&&"boosh"==n.boosh,"correctly evaluated response as JSONP with custom callback"),e()}})}),e("Unnamed callback in query string",function(e){ajax({url:"/tests/fixtures/fixtures_jsonp3.jsonp?foo=?",type:"jsonp",jsonpCallback:"foo",success:function(n){t(n,"received response for custom wildcard callback"),t(n&&"boosh"==n.boosh,"correctly evaled response as JSONP with custom wildcard cb"),e()}})}),e("No callback, no query string",function(e){ajax({url:"/tests/fixtures/fixtures_jsonp3.jsonp",type:"jsonp",jsonpCallback:"foo",success:function(n){t(n,"received response for custom wildcard callback"),t(n&&"boosh"==n.boosh,"correctly evaled response as JSONP with custom cb not in url"),e()}})}),e("No callback in existing query string",function(e){ajax({url:"/tests/none.jsonp?echo&somevar=some+long+str+here",type:"jsonp",jsonpCallbackName:"yohoho",success:function(n){t(n&&n.query,"received response from echo callback"),t(n&&n.query&&"some long str here"==n.query.somevar,"correctly evaluated response as JSONP with echo callback"),e()}})}),e("Append data to existing query string",function(e){ajax({url:"/tests/none.jsonp?echo",type:"jsonp",data:{somevar:"some long str here",anothervar:"yo ho ho!"},success:function(n){t(n&&n.query,"received response from echo callback"),t(n&&n.query&&"some long str here"==n.query.somevar,"correctly sent and received data object from JSONP echo (1)"),t(n&&n.query&&"yo ho ho!"==n.query.anothervar,"correctly sent and received data object from JSONP echo (2)"),e()}})}),e("Generate complete query string from data",function(e){ajax({url:"/tests/none.jsonp",type:"jsonp",data:[{name:"somevar",value:"some long str here"},{name:"anothervar",value:"yo ho ho!"},{name:"echo",value:!0}],success:function(n){t(n&&n.query,"received response from echo callback"),t(n&&n.query&&"some long str here"==n.query.somevar,"correctly sent and received data array from JSONP echo (1)"),t(n&&n.query&&"yo ho ho!"==n.query.anothervar,"correctly sent and received data array from JSONP echo (2)"),e()}})}),e("Append data to query string and insert callback name",function(e){ajax({url:"/tests/none.jsonp?callback=?",type:"jsonp",jsonpCallbackName:"reqwest_foo",data:{foo:"bar",boo:"baz",echo:!0},success:function(n){t(n&&n.query,"received response from echo callback"),t(n&&n.query&&"reqwest_foo"==n.query.callback,"correctly matched callback in URL"),e()}})})}),sink("Callbacks",function(test,ok){test("sync version",function(done){var r=ajax({method:"get",url:"/tests/fixtures/fixtures.json",type:"json",async:!1}),request=r.request,responseText=void 0!==request.response?request.response:request.responseText;ok("boosh"==eval("("+responseText+")").boosh,"can make sync calls"),done()}),test("no callbacks",function(e){var t=!0;try{ajax("/tests/fixtures/fixtures.js")}catch(n){t=!1}finally{ok(t,"successfully doesnt fail without callback"),e()}}),test("complete is called",function(e){ajax({url:"/tests/fixtures/fixtures.js",complete:function(){ok(!0,"called complete"),e()}})}),test("invalid JSON sets error on resp object",function(e){ajax({url:"/tests/fixtures/invalidJSON.json",type:"json",success:function(){ok(!1,"success callback fired"),e()},error:function(t,n){ok("Could not parse JSON in response"==n,"error callback fired"),e()}})}),test("multiple parallel named JSONP callbacks",8,function(){ajax({url:"/tests/fixtures/fixtures_jsonp_multi.jsonp?callback=reqwest_0",type:"jsonp",success:function(e){ok(e,"received response from call #1"),ok(e&&"a"==e.a,"evaluated response from call #1 as JSONP")}}),ajax({url:"/tests/fixtures/fixtures_jsonp_multi_b.jsonp?callback=reqwest_0",type:"jsonp",success:function(e){ok(e,"received response from call #2"),ok(e&&"b"==e.b,"evaluated response from call #2 as JSONP")}}),ajax({url:"/tests/fixtures/fixtures_jsonp_multi_c.jsonp?callback=reqwest_0",type:"jsonp",success:function(e){ok(e,"received response from call #2"),ok(e&&"c"==e.c,"evaluated response from call #3 as JSONP")}}),ajax({url:"/tests/fixtures/fixtures_jsonp_multi.jsonp?callback=reqwest_0",type:"jsonp",success:function(e){ok(e,"received response from call #2"),ok(e&&"a"==e.a,"evaluated response from call #4 as JSONP")}})}),test("JSONP also supports success promises",function(e){ajax({url:"/tests/none.jsonp?echo",type:"jsonp",success:function(e){ok(e,"received response in constructor success callback")}}).then(function(e){return ok(e,"received response in promise success callback"),e}).then(function(t){ok(t,"received response in second promise success callback"),e()})}),test("JSONP also supports error promises",function(e){ajax({url:"/tests/timeout/",type:"jsonp",error:function(e){ok(e,"received error response in constructor error callback")}}).fail(function(e){ok(e,"received error response in promise error callback")}).fail(function(t){ok(t,"received error response in second promise error callback"),e()}).abort()})}),window.XMLHttpRequest&&"withCredentials"in new window.XMLHttpRequest&&sink("Cross-origin Resource Sharing",function(e,t){e("make request to another origin",1,function(){ajax({url:"http://"+window.location.hostname+":5678/get-value",type:"text",method:"get",crossOrigin:!0,complete:function(e){t("hello"===e.responseText,"request made successfully")}})}),e("set cookie on other origin",2,function(){ajax({url:"http://"+window.location.hostname+":5678/set-cookie",type:"text",method:"get",crossOrigin:!0,withCredentials:!0,before:function(e){t(e.withCredentials===!0,"has set withCredentials on connection object")},complete:function(e){t(200===e.status,"cookie set successfully")}})}),e("get cookie from other origin",1,function(){ajax({url:"http://"+window.location.hostname+":5678/get-cookie-value",type:"text",method:"get",crossOrigin:!0,withCredentials:!0,complete:function(e){t("hello"==e.responseText,"cookie value retrieved successfully")}})})}),sink("Connection Object",function(e,t){function n(e,n,i,r){FakeXHR.setup();try{ajax({url:e,data:n}),t(1==FakeXHR.last.methodCallCount("open"),"open called"),t(3==FakeXHR.last.methodCallArgs("open",0).length,"open called with 3 args"),t("GET"==FakeXHR.last.methodCallArgs("open",0,0),'first arg of open() is "GET"'),t(FakeXHR.last.methodCallArgs("open",0,1)==i,"second arg of open() is URL with query string"),t(FakeXHR.last.methodCallArgs("open",0,2)===!0,"third arg of open() is `true`"),t(1==FakeXHR.last.methodCallCount("send"),"send called"),t(1==FakeXHR.last.methodCallArgs("send",0).length,"send called with 1 arg"),t(null===FakeXHR.last.methodCallArgs("send",0,0),"send called with null"),r()}finally{FakeXHR.restore()}}e("use xhr factory provided in the options",function(e){var n,i;"undefined"!=typeof XMLHttpRequest?i=new XMLHttpRequest:"undefined"!=typeof ActiveXObject?i=new ActiveXObject("Microsoft.XMLHTTP"):t(!1,"browser not supported"),n=ajax({url:"/tests/fixtures/fixtures.html",xhr:function(){return i}}),t(n.request===i,"uses factory"),e()}),e("fallbacks to own xhr factory if falsy is returned",function(e){var n;FakeXHR.setup();try{n=ajax({url:"/tests/fixtures/fixtures.html",xhr:function(){return null}}),t(n.request instanceof FakeXHR,"fallbacks correctly"),e()}finally{FakeXHR.restore()}}),e("setRequestHeaders",function(e){ajax({url:"/tests/fixtures/fixtures.html",data:"foo=bar&baz=thunk",method:"post",headers:{Accept:"application/x-foo"},success:function(){t(!0,"can post headers"),e()}})}),e("can inspect http before send",function(e){var n=ajax({url:"/tests/fixtures/fixtures.js",method:"post",type:"js",before:function(e){t(1==e.readyState,"received http connection object")},success:function(){setTimeout(function(){t(4==n.request.readyState,"success callback has readyState of 4"),e()},0)}})}),e("ajax() encodes array `data`",function(e){FakeXHR.setup();try{ajax({url:"/tests/fixtures/fixtures.html",method:"post",data:[{name:"foo",value:"bar"},{name:"baz",value:"thunk"}]}),t(1==FakeXHR.last.methodCallCount("send"),"send called"),t(1==FakeXHR.last.methodCallArgs("send",0).length,"send called with 1 arg"),t("foo=bar&baz=thunk"==FakeXHR.last.methodCallArgs("send",0,0),"send called with encoded array"),e()}finally{FakeXHR.restore()}}),e("ajax() encodes hash `data`",function(e){FakeXHR.setup();try{ajax({url:"/tests/fixtures/fixtures.html",method:"post",data:{bar:"foo",thunk:"baz"}}),t(1==FakeXHR.last.methodCallCount("send"),"send called"),t(1==FakeXHR.last.methodCallArgs("send",0).length,"send called with 1 arg"),t("bar=foo&thunk=baz"==FakeXHR.last.methodCallArgs("send",0,0),"send called with encoded array"),e()}finally{FakeXHR.restore()}}),e("ajax() obeys `processData`",function(e){FakeXHR.setup();try{var n={bar:"foo",thunk:"baz"};ajax({url:"/tests/fixtures/fixtures.html",processData:!1,method:"post",data:n}),t(1==FakeXHR.last.methodCallCount("send"),"send called"),t(1==FakeXHR.last.methodCallArgs("send",0).length,"send called with 1 arg"),t(FakeXHR.last.methodCallArgs("send",0,0)===n,"send called with exact `data` object"),e()}finally{FakeXHR.restore()}}),e("ajax() appends GET URL with ?`data`",function(e){n("/tests/fixtures/fixtures.html","bar=foo&thunk=baz","/tests/fixtures/fixtures.html?bar=foo&thunk=baz",e)}),e("ajax() appends GET URL with ?`data` (serialized object)",function(e){n("/tests/fixtures/fixtures.html",{bar:"foo",thunk:"baz"},"/tests/fixtures/fixtures.html?bar=foo&thunk=baz",e)}),e("ajax() appends GET URL with &`data` (serialized array)",function(e){n("/tests/fixtures/fixtures.html?x=y",[{name:"bar",value:"foo"},{name:"thunk",value:"baz"}],"/tests/fixtures/fixtures.html?x=y&bar=foo&thunk=baz",e)})}),sink("Standard vs compat mode",function(e,t){function n(e,t){return e&&e.method===t}function i(e,t,n){return e&&e.headers&&e.headers[t]===n}function r(e,t,n){return e&&e.query&&e.query[t]===n}e("standard mode default",function(e){ajax({url:"/tests/none.json?echo",success:function(r){t(n(r,"GET"),"correct request method (GET)"),t(i(r,"content-type","application/x-www-form-urlencoded"),"correct Content-Type request header"),t(i(r,"x-requested-with","XMLHttpRequest"),"correct X-Requested-With header"),t(i(r,"accept","text/javascript, text/html, application/xml, text/xml, */*"),"correct Accept header"),e()}})}),e("standard mode custom content-type",function(e){ajax({url:"/tests/none.json?echo",contentType:"yapplication/foobar",success:function(r){t(n(r,"GET"),"correct request method (GET)"),t(i(r,"content-type","yapplication/foobar"),"correct Content-Type request header"),t(i(r,"x-requested-with","XMLHttpRequest"),"correct X-Requested-With header"),t(i(r,"accept","text/javascript, text/html, application/xml, text/xml, */*"),"correct Accept header"),e()}})}),e('compat mode "dataType=json" headers',function(e){ajax.compat({url:"/tests/none.json?echo",dataType:"json",success:function(r){t(n(r,"GET"),"correct request method (GET)"),t(i(r,"content-type","application/x-www-form-urlencoded"),"correct Content-Type request header"),t(i(r,"x-requested-with","XMLHttpRequest"),"correct X-Requested-With header"),t(i(r,"accept","application/json, text/javascript"),"correct Accept header"),e()}})}),e('compat mode "dataType=json" with "type=post" headers',function(e){ajax.compat({url:"/tests/none.json?echo",type:"post",dataType:"json",success:function(r){t(n(r,"POST"),"correct request method (POST)"),t(i(r,"content-type","application/x-www-form-urlencoded"),"correct Content-Type request header"),t(i(r,"x-requested-with","XMLHttpRequest"),"correct X-Requested-With header"),t(i(r,"accept","application/json, text/javascript"),"correct Accept header"),e()}})}),e('compat mode "dataType=json" headers (with additional headers)',function(e){ajax.compat({url:"/tests/none.json?echo",dataType:"json",headers:{one:1,two:2},success:function(n){t(i(n,"content-type","application/x-www-form-urlencoded"),"correct Content-Type request header"),t(i(n,"x-requested-with","XMLHttpRequest"),"correct X-Requested-With header"),t(i(n,"accept","application/json, text/javascript"),"correct Accept header"),t(i(n,"one","1")&&i(n,"two","2"),"left additional headers intact"),e()}})}),e('compat mode "dataType=jsonp" query string',function(e){ajax.compat({url:"/tests/none.jsonp?echo",dataType:"jsonp",jsonp:"testCallback",jsonpCallback:"foobar",success:function(n){t(r(n,"echo",""),"correct Content-Type request header"),t(r(n,"testCallback","foobar"),"correct X-Requested-With header"),e()}})})}),sink("Serializing",function(e,t){var n=createSerializeHelper(t);n.reset(),e("correctly serialize textarea",function(e){var i,r=n.formElements(1,"textarea",0);t("T3=%3F%0D%0AA+B%0D%0AZ"==ajax.serialize(r),"serialize(textarea)"),i=ajax.serialize(r,{type:"array"}),t(1==i.length,"serialize(textarea, {type:'array'}) returns array"),i=i[0],t("T3"==i.name,"serialize(textarea, {type:'array'}).name"),t("?\r\nA B\r\nZ"==i.value,"serialize(textarea, {type:'array'}).value"),t("?\r\nA B\r\nZ"==ajax.serialize(r,{type:"map"}).T3,"serialize(textarea, {type:'map'})"),e()}),e("correctly serialize input[type=hidden]",function(e){n.testInput(n.formElements(1,"input",0),"H1","x","hidden"),n.testInput(n.formElements(1,"input",1),"H2","","hidden[no value]"),e()}),e("correctly serialize input[type=password]",function(e){n.testInput(n.formElements(1,"input",2),"PWD1","xyz","password"),n.testInput(n.formElements(1,"input",3),"PWD2","","password[no value]"),e()}),e("correctly serialize input[type=text]",function(e){n.testInput(n.formElements(1,"input",4),"T1","","text[no value]"),n.testInput(n.formElements(1,"input",5),"T2","YES","text[readonly]"),n.testInput(n.formElements(1,"input",10),"My Name","me","text[space name]"),e()}),e("correctly serialize input[type=checkbox]",function(e){var t=n.formElements(1,"input",6),i=n.formElements(1,"input",7);n.testInput(t,"C1",null,"checkbox[not checked]"),t.checked=!0,n.testInput(t,"C1","1","checkbox[checked]"),n.testInput(i,"C2",null,"checkbox[no value, not checked]"),i.checked=!0,n.testInput(i,"C2","on","checkbox[no value, checked]"),e()}),e("correctly serialize input[type=radio]",function(e){var t=n.formElements(1,"input",8),i=n.formElements(1,"input",9);n.testInput(t,"R1",null,"radio[not checked]"),t.checked=!0,n.testInput(t,"R1","1","radio[not checked]"),n.testInput(i,"R1",null,"radio[no value, not checked]"),i.checked=!0,n.testInput(i,"R1","","radio[no value, checked]"),e()}),e("correctly serialize input[type=reset]",function(e){n.testInput(n.formElements(1,"input",11),"rst",null,"reset"),e()}),e("correctly serialize input[type=file]",function(e){n.testInput(n.formElements(1,"input",12),"file",null,"file"),e()}),e("correctly serialize input[type=submit]",function(e){n.testInput(n.formElements(1,"input",13),"sub","NO","submit"),e()}),e("correctly serialize select with no options",function(e){var t=n.formElements(1,"select",0);n.testInput(t,"S1",null,"select, no options"),e()}),e("correctly serialize select with values",function(e){var t=n.formElements(1,"select",1);n.testInput(t,"S2","abc","select option 1 (default)"),t.selectedIndex=1,n.testInput(t,"S2","def","select option 2"),t.selectedIndex=6,n.testInput(t,"S2","disco stu","select option 7"),t.selectedIndex=9,n.testInput(t,"S2","",'select option 9, value="" should yield ""'),t.selectedIndex=-1,n.testInput(t,"S2",null,"select, unselected"),e()}),e("correctly serialize select without explicit values",function(e){var t=n.formElements(1,"select",2);n.testInput(t,"S3","ABC","select option 1 (default)"),t.selectedIndex=1,n.testInput(t,"S3","DEF","select option 2"),t.selectedIndex=6,n.testInput(t,"S3","DISCO STU!","select option 7"),t.selectedIndex=-1,n.testInput(t,"S3",null,"select, unselected"),e()}),e("correctly serialize select multiple",function(e){var t=n.formElements(1,"select",3);n.testInput(t,"S4",null,"select, unselected (default)"),t.options[1].selected=!0,n.testInput(t,"S4","2","select option 2"),t.options[3].selected=!0,n.testInput(t,"S4",["2","4"],"select options 2 & 4"),t.options[8].selected=!0,n.testInput(t,"S4",["2","4","Disco Stu!"],"select option 2 & 4 & 9"),t.options[3].selected=!1,n.testInput(t,"S4",["2","Disco Stu!"],"select option 2 & 9"),t.options[1].selected=!1,t.options[8].selected=!1,n.testInput(t,"S4",null,"select, all unselected"),e()}),e("correctly serialize options",function(e){var t=n.formElements(1,"select",1).options[6];n.testInput(t,"-",null,"just option (with value), shouldn't serialize"),t=n.formElements(1,"select",2).options[6],n.testInput(t,"-",null,"option (without value), shouldn't serialize"),e()}),e("correctly serialize disabled",function(e){var t,i=n.formElements(1,"input",14);n.testInput(i,"D1",null,"disabled text input"),i=n.formElements(1,"input",15),n.testInput(i,"D2",null,"disabled checkbox"),i=n.formElements(1,"input",16),n.testInput(i,"D3",null,"disabled radio"),t=n.formElements(1,"select",4),n.testInput(t,"D4",null,"disabled select"),t=n.formElements(1,"select",3),n.testInput(t,"D5",null,"disabled select option"),t=n.formElements(1,"select",6),n.testInput(t,"D6",null,"disabled multi select"),t=n.formElements(1,"select",7),n.testInput(t,"D7",null,"disabled multi select option"),e()}),e("serialize(form)",function(e){n.testFormSerialize(ajax.serialize,"direct"),e()}),e("serialize(form, {type:'array'})",function(e){n.testFormSerializeArray(ajax.serialize,"direct"),e()}),e("serialize(form, {type:'map'})",function(e){n.testFormSerializeHash(ajax.serialize,"direct"),e()}),e("serialize(element, element, element...)",function(e){n.testMultiArgumentSerialize(ajax.serialize,"direct",PASS_ARGS),e()}),e("serialize(element, element, element..., {type:'array'})",function(e){n.testMultiArgumentSerializeArray(ajax.serialize,"direct",PASS_ARGS),e()}),e("serialize(element, element, element...)",function(e){n.testMultiArgumentSerializeHash(ajax.serialize,"direct",PASS_ARGS),e()}),e("toQueryString([{ name: x, value: y }, ... ]) name/value array",function(e){var n=[{name:"foo",value:"bar"},{name:"baz",value:""},{name:"x",value:-20},{name:"x",value:20}];t("foo=bar&baz=&x=-20&x=20"==ajax.toQueryString(n),"simple"),n=[{name:"dotted.name.intact",value:"$@%"},{name:"$ $",value:20},{name:"leave britney alone",value:"waa haa haa"}],t("dotted.name.intact=%24%40%25&%24+%24=20&leave+britney+alone=waa+haa+haa"==ajax.toQueryString(n),"escaping required"),e()}),e("toQueryString({name: value,...} complex object",function(e){var n={foo:"bar",baz:"",x:-20};t("foo=bar&baz=&x=-20"==ajax.toQueryString(n),"simple"),n={"dotted.name.intact":"$@%","$ $":20,"leave britney alone":"waa haa haa"},t("dotted.name.intact=%24%40%25&%24+%24=20&leave+britney+alone=waa+haa+haa"==ajax.toQueryString(n),"escaping required"),e()}),e("toQueryString({name: [ value1, value2 ...],...} object with arrays",function(e){var n={foo:"bar",baz:["","","boo!"],x:[-20,2.2,20]};t("foo=bar&baz=&baz=&baz=boo!&x=-20&x=2.2&x=20"==ajax.toQueryString(n,!0),"object with arrays"),t("foo=bar&baz%5B%5D=&baz%5B%5D=&baz%5B%5D=boo!&x%5B%5D=-20&x%5B%5D=2.2&x%5B%5D=20"==ajax.toQueryString(n)),e()}),e("toQueryString({name: { nestedName: value },...} object with objects",function(e){var n={foo:{bar:"baz"},x:[{bar:"baz"},{boo:"hiss"}]};t("foo%5Bbar%5D=baz&x%5B0%5D%5Bbar%5D=baz&x%5B1%5D%5Bboo%5D=hiss"==ajax.toQueryString(n),"object with objects"),e()})}),sink("Ender Integration",function(e,t){var n=createSerializeHelper(t);n.reset(),e("$.ajax alias for reqwest, not bound to boosh",1,function(){t(ender.ajax===ajax,"$.ajax is reqwest")}),e("$.serialize(form)",function(e){n.testFormSerialize(ender.serialize,"ender"),e()}),e("$.serialize(form, {type:'array'})",function(e){n.testFormSerializeArray(ender.serialize,"ender"),e()}),e("$.serialize(form, {type:'map'})",function(e){n.testFormSerializeHash(ender.serialize,"ender"),e()}),e("$.serializeArray(...) alias for serialize(..., {type:'map'}",function(e){n.verifyFormSerializeArray(ender.serializeArray(document.forms[0]),"ender"),e()}),e("$.serialize(element, element, element...)",function(e){n.testMultiArgumentSerialize(ender.serialize,"ender",PASS_ARGS),e()}),e("$.serialize(element, element, element..., {type:'array'})",function(e){n.testMultiArgumentSerializeArray(ender.serialize,"ender",PASS_ARGS),e()}),e("$.serialize(element, element, element..., {type:'map'})",function(e){n.testMultiArgumentSerializeHash(ender.serialize,"ender",PASS_ARGS),e()}),e("$(element, element, element...).serialize()",function(e){n.testMultiArgumentSerialize(ender.fn.serialize,"ender",BIND_ARGS),e()}),e("$(element, element, element...).serialize({type:'array'})",function(e){n.testMultiArgumentSerializeArray(ender.fn.serialize,"ender",BIND_ARGS),e()}),e("$(element, element, element...).serialize({type:'map'})",function(e){n.testMultiArgumentSerializeHash(ender.fn.serialize,"ender",BIND_ARGS),e()}),e("$.toQueryString alias for reqwest.toQueryString, not bound to boosh",function(e){t(ender.toQueryString===ajax.toQueryString,"$.toQueryString is reqwest.toQueryString"),e()})}),sink("Promises",function(e,t){e("always callback is called",function(e){ajax({url:"/tests/fixtures/fixtures.js"}).always(function(){t(!0,"called complete"),e()})}),e("success and error handlers are called",3,function(){ajax({url:"/tests/fixtures/invalidJSON.json",type:"json"}).then(function(){t(!1,"success callback fired")},function(e,n){t("Could not parse JSON in response"==n,"error callback fired")}),ajax({url:"/tests/fixtures/invalidJSON.json",type:"json"}).fail(function(e,n){t("Could not parse JSON in response"==n,"fail callback fired")}),ajax({url:"/tests/fixtures/fixtures.json",type:"json"}).then(function(){t(!0,"success callback fired")},function(){t(!1,"error callback fired")})}),e("then is chainable",2,function(){ajax({url:"/tests/fixtures/fixtures.json",type:"json"}).then(function(){return t(!0,"first success callback fired"),"new value"}).then(function(e){t("new value"===e,"second success callback fired")})}),e("success does not chain with then",2,function(){ajax({url:"/tests/fixtures/fixtures.json",type:"json",success:function(){return t(!0,"success callback fired"),"some independent value"}}).then(function(e){t(e&&"some independent value"!==e,"then callback fired")})}),e("then & always handlers can be added after a response is received",2,function(){var e=ajax({url:"/tests/fixtures/fixtures.json",type:"json"}).always(function(){setTimeout(function(){e.then(function(){t(!0,"success callback called")},function(){t(!1,"error callback called")}).always(function(){t(!0,"complete callback called")})},1)})}),e("then is chainable after a response is received",2,function(){var e=ajax({url:"/tests/fixtures/fixtures.json",type:"json"}).always(function(){setTimeout(function(){e.then(function(){return t(!0,"first success callback called"),"new value"}).then(function(e){t("new value"===e,"second success callback called")})},1)})}),e("failure handlers can be added after a response is received",function(e){var n=ajax({url:"/tests/fixtures/invalidJSON.json",type:"json"}).always(function(){setTimeout(function(){n.fail(function(){t(!0,"fail callback called"),e()})},1)})}),e(".then success and fail are optional parameters",1,function(){try{ajax({url:"/tests/fixtures/invalidJSON.json",type:"json"}).then()}catch(e){t(!1,".then() parameters should be optional")}finally{t(!0,"passed .then() optional parameters")}})}),sink("Timeout",function(e,t){e("xmlHttpRequest",function(e){var n=+new Date;ajax({url:"/tests/timeout",type:"json",timeout:250,error:function(i){t(i,"received error response");try{t(i&&0===i.status,"correctly caught timeout")}catch(r){t(!0,"IE is a troll")}var a=Math.abs(+new Date-n);t(a>200&&300>a,"timeout close enough to 250 ("+a+")"),e()}})}),e("jsonpRequest",function(e){var n=+new Date;ajax({url:"/tests/timeout",type:"jsonp",timeout:250,error:function(i){t(i,"received error response");var r=Math.abs(+new Date-n);t(r>200&&300>r,"timeout close enough to 250 ("+r+")"),e()}})})}),start()})(reqwest)}});